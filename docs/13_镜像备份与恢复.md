# 镜像备份

## Ubuntu下备份教程

* 推荐在Ubuntu系统下进行镜像备份操作
* 需要准备如下：
    1. 需要备份的镜像SD卡
    2. SD卡读卡器
    3. 装有Ubuntu系统的电脑（推荐版本为大于等于18.04）且电脑剩余硬盘空间大于20G

### 操作如下

1. 在Ubuntu系统下打开终端输入指令 ```sudo parted –l```，回车
2. 然后将SD卡插入读卡器，再将读卡器插上电脑
3. 再次使用指令 ```sudo parted –l```  ，回车，查看该SD卡系统的存储情况，一般为在上一步基础上新增的部分
4. 根据SD卡的实际容量，找到对应的挂载，如挂载为 ```/dev/sdb```
5. 确认保存路径和镜像名字
6. 输入指令开始制作镜像
    *  其中，/dev/sdb，是SD卡挂载位置
    *  ~/，是镜像保存路径
    *  raspberryPi，是镜像名字
    * sudo dd if=/dev/sdb conv=sync,noerror bs=64K | gzip -c > ~/raspberryPi.image.img.gz
    * 或sudo dd if=/dev/sdb conv=sync,noerror bs=64K | pv -s 128G | gzip -c > ~/raspberryPi.image.img.gz 可以查看进度，一般来说制作镜像文件大小不超过10个G。
7. 等待指令运行，当上面的指令在终端运行结束，则说明镜像制作完成，即可保存对应路径的镜像文件

## Ubuntu下恢复教程

* 需要提前格式化SD卡
* 需要准备一张比做镜像的那张SD卡容量，一样或者更大的SD卡

### 操作如下

1. 在Ubuntu系统下打开终端输入指令 ```sudo parted –l```，回车
2. 然后将SD卡插入读卡器，再将读卡器插上电脑
3. 再次使用指令 ```sudo parted –l```  ，回车，查看该SD卡系统的存储情况，一般为在上一步基础上新增的部分
4. 根据SD卡的实际容量，找到对应的挂载，如挂载为 ```/dev/sdb```
5. 确认镜像文件路径和镜像名字
6. 输入指令开始恢复镜像到SD卡中
    *  其中，/dev/sdb，是SD卡挂载位置
    *  ~/，是镜像保存路径
    *  raspberryPi，是镜像名字
    * sudo gzip -dc ~/raspberryPi.image.img.gz | sudo dd of=/dev/sdb
7. 等待指令运行，当上面的指令在终端运行结束，则说明镜像恢复完成，即可弹出SD卡设备